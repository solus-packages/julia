name       : julia
version    : 0.6.0_rc2
release    : 7
source     :
    - git|https://github.com/JuliaLang/julia.git : v0.6.0-rc2
license    : MIT
component  : programming
summary    : The Julia Language - A fresh approach to technical computing.
networking : yes
description: |
    The Julia Language - A fresh approach to technical computing.
builddeps  :
    - pkgconfig(fftw3)
    - pkgconfig(libgit2)
    - pkgconfig(libssh2)
    - pkgconfig(libunwind)
    - pkgconfig(libpcre2-8)
    - arpack-devel
    - llvm-devel
    - openblas-devel
    - suitesparse-devel
clang      : yes
rundeps    :
    - arpack
    - libgit2
    - pcre2
    - suitesparse
patterns   :
    - docs : [/usr/share/doc]
build      : |
    #Based off Gentoo patch
    %patch -p1 < $pkgfiles/julia-fix-llvm-linking.patch
    %make release prefix=/usr sysconfdir=/etc MARCH=x86-64 \
        LIBBLASNAME=libopenblas \
        LIBLAPACKNAME=libopenblas \
        USE_LLVM_SHLIB=1 \
        USE_SYSTEM_ARPACK=1 \
        USE_SYSTEM_BLAS=1 \
        USE_SYSTEM_CURL=1 \
        USE_SYSTEM_FFTW=1 \
        USE_SYSTEM_GMP=1 \
        USE_SYSTEM_LAPACK=1 \
        USE_SYSTEM_LIBGIT2=1 \
        USE_SYSTEM_LIBSSH2=1 \
        USE_SYSTEM_LIBUNWIND=1 \
        USE_SYSTEM_LLVM=1 \
        USE_SYSTEM_MPFR=1 \
        USE_SYSTEM_PCRE=1 \
        USE_SYSTEM_SUITESPARSE=1 \
        CC=clang CXX=clang++ \
install    : |
    %make_install release prefix=/usr sysconfdir=/etc MARCH=x86-64 \
        LIBBLASNAME=libopenblas \
        LIBLAPACKNAME=libopenblas \
        USE_LLVM_SHLIB=1 \
        USE_SYSTEM_ARPACK=1 \
        USE_SYSTEM_BLAS=1 \
        USE_SYSTEM_CURL=1 \
        USE_SYSTEM_FFTW=1 \
        USE_SYSTEM_GMP=1 \
        USE_SYSTEM_LAPACK=1 \
        USE_SYSTEM_LIBGIT2=1 \
        USE_SYSTEM_LIBSSH2=1 \
        USE_SYSTEM_LIBUNWIND=1 \
        USE_SYSTEM_LLVM=1 \
        USE_SYSTEM_MPFR=1 \
        USE_SYSTEM_PCRE=1 \
        USE_SYSTEM_SUITESPARSE=1 \
        CC=clang CXX=clang++
    # Empty folder
    rm -rf $installdir/usr/libexec
    echo '/usr/lib/julia' > julia.conf
    install -Dm00644 julia.conf $installdir/etc/ld.so.conf.d/julia.conf
